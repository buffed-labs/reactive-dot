name: Push

on:
  push:
    branches: [main]

jobs:
  verify:
    uses: ./.github/workflows/verification.yml

  publish:
    needs: verify
    uses: ./.github/workflows/publishing.yml
    concurrency: ${{ github.workflow }}-${{ github.ref }}-${{ github.job }}
    permissions:
      contents: write
      pull-requests: write
    secrets: inherit

  deploy:
    needs: verify
    uses: ./.github/workflows/deployment.yml
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}-${{ github.job }}
      cancel-in-progress: true
    permissions:
      contents: read
      deployments: write
    secrets: inherit
